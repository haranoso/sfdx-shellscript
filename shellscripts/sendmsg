#!/bin/bash

set -eu

# パイプの有無
if [ -p /dev/stdin ]; then
	MESSAGE=`cat - | sed s/\"/\'/g`
	echo "$MESSAGE"
else
	echo "nothing stdin"
	exit 1
fi

# WebHookのURL
URL='https://hooks.slack.com/services/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'
# 送信先のチャンネル
CHANNEL=${CHANNEL:-'#app_test'}
# botの名前
BOTNAME=${BOTNAME:-'test-bot'}
# 絵文字
EMOJI=${EMOJI:-':sushi:'}
# 見出し
HEAD=${HEAD:-"midashi\n"}

# json形式に整形
payload="payload={
	\"channel\": \"${CHANNEL}\",
	\"username\": \"${BOTNAME}\",
	\"icon_emoji\": \"${EMOJI}\",
	\"attachments\":[
		{\"text\": \"$MESSAGE\"}
	]
}"

# 送信
curl -s -S -X POST --data-urlencode "${payload}" ${URL} > /dev/null
